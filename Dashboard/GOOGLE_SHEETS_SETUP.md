# üìä ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Google Apps Script API

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script

### 1.1 ‡πÄ‡∏õ‡∏¥‡∏î Google Sheets
1. ‡πÄ‡∏õ‡∏¥‡∏î Google Sheets ‡∏ó‡∏µ‡πà ID: `1RJ9OI8Bz8Xy_7HW7fZVQnjeYshDd0BZUZrkG3ycJfy0`
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ Sheet ‡∏ä‡∏∑‡πà‡∏≠ **"Tank"** ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### 1.2 ‡∏™‡∏£‡πâ‡∏≤‡∏á Header ‡πÉ‡∏ô Sheet
‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á Header ‡πÉ‡∏ô Sheet "Tank" ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

| A | B | C | D | E |
|---|---|---|---|---|
| Timestamp | Level | Status | Flow | Temp |

### 1.3 ‡πÄ‡∏õ‡∏¥‡∏î Apps Script Editor
1. ‡πÉ‡∏ô Google Sheets ‡∏Ñ‡∏•‡∏¥‡∏Å: **Extensions** ‚Üí **Apps Script**
2. ‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
3. Copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå `google_apps_script_api.gs` ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á
4. ‡∏Ñ‡∏•‡∏¥‡∏Å **üíæ Save** (Ctrl+S)

---

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î

### 2.1 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Editor
1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô: `testGetLatest`
2. ‡∏Ñ‡∏•‡∏¥‡∏Å **‚ñ∂ Run**
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Log (View ‚Üí Logs ‡∏´‡∏£‡∏∑‡∏≠ Ctrl+Enter)
4. ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏Ç‡∏≠‡∏á‡∏ñ‡∏±‡∏á‡∏ô‡πâ‡∏≥

### 2.2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Output ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:
```json
{
  "waterTank": {
    "timestamp": "2026-01-12T09:52:26.000Z",
    "level": 7378,
    "status": "NORMAL",
    "flow": 45.2,
    "temp": 28.5
  },
  "machines": []
}
```

---

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: Deploy ‡πÄ‡∏õ‡πá‡∏ô Web App

### 3.1 Deploy
1. ‡∏Ñ‡∏•‡∏¥‡∏Å **Deploy** ‚Üí **New deployment**
2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô **‚öôÔ∏è Settings** (‡πÄ‡∏ü‡∏∑‡∏≠‡∏á‡∏Ç‡πâ‡∏≤‡∏á "Select type")
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: **Web app**
4. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
   - **Description**: `Water Tank API v1`
   - **Execute as**: **Me** (‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
   - **Who has access**: **Anyone** ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!
5. ‡∏Ñ‡∏•‡∏¥‡∏Å **Deploy**

### 3.2 ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Permissions
1. ‡∏Ñ‡∏•‡∏¥‡∏Å **Authorize access**
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Google ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
3. ‡∏Ñ‡∏•‡∏¥‡∏Å **Advanced** ‚Üí **Go to [your project] (unsafe)**
4. ‡∏Ñ‡∏•‡∏¥‡∏Å **Allow**

### 3.3 ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL
- ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å **Web app URL** ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
- ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: `https://script.google.com/macros/s/AKfycby.../exec`
- **‡πÄ‡∏Å‡πá‡∏ö URL ‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ** ‡∏à‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Dashboard

---

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API

### 4.1 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô Browser
‡πÄ‡∏õ‡∏¥‡∏î Browser ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy:
```
https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec
```

### 4.2 ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ:
```json
{
  "waterTank": {
    "timestamp": "2026-01-12T09:52:26.000Z",
    "level": 7378,
    "status": "NORMAL",
    "flow": 45.2,
    "temp": 28.5
  },
  "machines": []
}
```

### 4.3 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:
‡πÄ‡∏û‡∏¥‡πà‡∏° parameter `?action=getAll`:
```
https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec?action=getAll
```

---

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dashboard

### 5.1 ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå index.html
- ‡∏´‡∏≤ line: `const [httpUrl, setHttpUrl] = useState(...)`

### 5.2 ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL
‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å:
```javascript
const [httpUrl, setHttpUrl] = useState('http://192.168.7.86:1880/machines');
```

‡πÄ‡∏õ‡πá‡∏ô:
```javascript
const [httpUrl, setHttpUrl] = useState('https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec');
```

### 5.3 ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡πà‡∏≤‡∏ô Settings
1. ‡πÄ‡∏õ‡∏¥‡∏î Dashboard
2. ‡∏Ñ‡∏•‡∏¥‡∏Å **‚öô SETTINGS**
3. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Mode ‡πÄ‡∏õ‡πá‡∏ô: **üåê Node-RED (HTTP)**
4. ‡∏ß‡∏≤‡∏á URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script
5. ‡∏Ñ‡∏•‡∏¥‡∏Å **Close**

---

## üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheet

### Headers ‡πÉ‡∏ô Sheet "Tank":
```
| Timestamp           | Level | Status | Flow | Temp |
|---------------------|-------|--------|------|------|
| 12/1/2026 16:52:26  | 7378  | NORMAL | 45.2 | 28.5 |
| 12/1/2026 16:52:28  | 7380  | NORMAL | 45.5 | 28.6 |
```

### ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå:
- **A (Timestamp)**: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
- **B (Level)**: ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ (‡∏•‡∏¥‡∏ï‡∏£)
- **C (Status)**: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (NORMAL/LOW)
- **D (Flow)**: ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏• (L/min)
- **E (Temp)**: ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)

---

## üîß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‚ùå Error: "Sheet not found"
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÑ‡∏°‡πà‡∏°‡∏µ Sheet ‡∏ä‡∏∑‡πà‡∏≠ "Tank"
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:** 
- ‡∏™‡∏£‡πâ‡∏≤‡∏á Sheet ‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏∑‡πà‡∏≠ "Tank" ‡πÉ‡∏ô Google Sheets
- ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô Apps Script: `const TANK_SHEET_NAME = "‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";`

### ‚ùå Error: "Authorization required"
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Authorize
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡πÉ‡∏ô Apps Script Editor ‡∏Ñ‡∏•‡∏¥‡∏Å **Run** ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å `testGetLatest`
- ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Permissions ‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3.2

### ‚ùå Error: "You do not have permission"
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ "Who has access" ‡∏ú‡∏¥‡∏î
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Apps Script ‚Üí **Deploy** ‚Üí **Manage deployments**
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Deployment ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô "Who has access" ‡πÄ‡∏õ‡πá‡∏ô **Anyone**

### ‚ùå Dashboard ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
**‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:**
1. ‡πÄ‡∏õ‡∏¥‡∏î Browser Console (F12) ‡∏î‡∏π error
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÉ‡∏ô Settings ‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
3. ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î URL ‡πÉ‡∏ô Browser tab ‡πÉ‡∏´‡∏°‡πà ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô JSON

### ‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏™‡∏î‡∏á 0 ‡∏´‡∏£‡∏∑‡∏≠ NO_DATA
**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** Sheet ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Node-RED ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡πÄ‡∏õ‡∏¥‡∏î Google Sheets ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 2):
  ```
  | 12/1/2026 16:52:26 | 7378 | NORMAL | 45.2 | 28.5 |
  ```

---

## üöÄ ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö

### ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
‡πÉ‡∏ô `index.html` ‡∏´‡∏≤:
```javascript
const interval = setInterval(fetchData, 2000);
```
‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô:
```javascript
const interval = setInterval(fetchData, 5000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
```

### ‡πÄ‡∏û‡∏¥‡πà‡∏° CORS Support (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô Apps Script:
```javascript
function doGet(e) {
  const response = // ... your code
  
  return ContentService
    .createTextOutput(JSON.stringify(response))
    .setMimeType(ContentService.MimeType.JSON);
}
```

---

## üìû ‡∏™‡∏£‡∏∏‡∏õ

1. ‚úÖ Copy ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å `google_apps_script_api.gs` ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script
2. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Sheet "Tank" ‡∏°‡∏µ Headers ‡∏Ñ‡∏£‡∏ö
3. ‚úÖ Deploy ‡πÄ‡∏õ‡πá‡∏ô Web App (Anyone access)
4. ‚úÖ Test URL ‡πÉ‡∏ô Browser
5. ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡πÉ‡∏ô Dashboard Settings
6. ‚úÖ ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Water Tank Tab

**‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!** üéâ
